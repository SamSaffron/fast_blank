#!/usr/bin/env ruby
$: << File.dirname(__FILE__)+'/lib'
require 'benchmark'
require 'fast_blank'

class String
  # active support implementation
  def slow_blank?
    /\A[[:space:]]*\z/ === self
  end
end


n = 1000000


strings = [
  "",
  "\r\n\r\n  ",
  "this is a test",
  "   this is a longer test",
  "   this is a longer test
      this is a longer test
      this is a longer test
      this is a longer test
      this is a longer test"
]

strings.each do |s|
  raise "failed on #{s.inspect}" if s.blank? != s.slow_blank?
end

Benchmark.bmbm  do |x|
  strings.each do |s|
    x.report("Fast Blank #{s.length}    :") do  n.times { s.blank? }  end
    x.report("Fast Blank (Active Support)  #{s.length}    :") do  n.times { s.blank_as? }  end
    x.report("Slow Blank #{s.length}    :") do  n.times { s.slow_blank? }  end
    #x.report("Empty #{s.length}    :") do  n.times { s.empty? }  end
  end
end

#                                             user     system      total        real
# Fast Blank 0    :                       0.080000   0.000000   0.080000 (  0.084032)
# Fast Blank (Active Support)  0    :     0.080000   0.000000   0.080000 (  0.083599)
# Slow Blank 0    :                       0.930000   0.050000   0.980000 (  0.986029)
# Fast Blank 6    :                       0.150000   0.000000   0.150000 (  0.156408)
# Fast Blank (Active Support)  6    :     0.130000   0.000000   0.130000 (  0.123618)
# Slow Blank 6    :                       1.080000   0.050000   1.130000 (  1.133616)
# Fast Blank 14    :                      0.090000   0.000000   0.090000 (  0.090577)
# Fast Blank (Active Support)  14    :    0.090000   0.000000   0.090000 (  0.096469)
# Slow Blank 14    :                      0.500000   0.000000   0.500000 (  0.501756)
# Fast Blank 24    :                      0.130000   0.000000   0.130000 (  0.124822)
# Fast Blank (Active Support)  24    :    0.110000   0.000000   0.110000 (  0.116654)
# Slow Blank 24    :                      0.560000   0.000000   0.560000 (  0.556493)
# Fast Blank 136    :                     0.130000   0.000000   0.130000 (  0.129399)
# Fast Blank (Active Support)  136    :   0.120000   0.000000   0.120000 (  0.120694)
# Slow Blank 136    :                     0.540000   0.000000   0.540000 (  0.545197)
